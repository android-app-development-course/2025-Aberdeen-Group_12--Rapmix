RapMix 项目个人研发难点与技术分析总结

在 RapMix 的研发过程中，我主要负责音频轨道创建、录音与文件导入流程、页面导航体系以及端侧音频处理前置逻辑的实现**。该项目并非简单的多页面 UI 应用，而是一个围绕 **音频采集 → 音轨管理 → 后续音频净化处理
构建的功能型 Android 应用，整体研发过程中涉及多项平台级能力与复杂状态管理问题。

一、核心技术选型与实际应用

RapMix 项目以 “Android / Kotlin” 作为开发平台，充分利用系统提供的 “麦克风、文件系统、权限管理与媒体能力”，保证录音与音频文件导入的稳定性与兼容性。

在 UI 与交互层面，我采用 “Jetpack Compose + Material3” 构建主要页面（Create、AddTrack、RecordTrack 等），通过状态驱动的方式控制按钮状态、录音流程与音轨选择反馈，相比传统 XML 布局更易维护且逻辑清晰。

在页面组织与流程控制上，使用 “Navigation Compose*” 管理多页面跳转关系，包括：

音轨创建页（AddTrack）
录音页（RecordTrack）
主流程页（Create）
其他功能页（社区、草稿、个人页）

通过统一的 NavHost 与路由常量，避免了多 Activity 架构下常见的状态丢失与回退混乱问题。

二、录音功能的端侧实现难点

录音功能是 RapMix 的核心入口之一，我通过 **MediaRecorder** 实现端侧音频采集，并将录音文件直接保存至应用的 `cacheDir`，形成可供后续处理的音频资源。

在实现过程中，需要重点解决以下问题：

运行时录音权限（RECORD_AUDIO）申请与处理**
不同 Android 版本下 `MediaRecorder` 构造方式差异（Android S+ 需传入 Context）
录音开始 / 停止状态与 UI 状态的严格同步
页面销毁或异常情况下，录音资源的安全释放，防止崩溃或麦克风占用

录音结束后，我将生成的音频文件路径转换为 `Uri String`，并通过导航回传至音轨管理流程中，为后续“启动净化”操作提供输入。

三、音频文件导入流程与系统交互

除录音外，RapMix 还支持从系统导入已有音频文件。我通过 **ActivityResultContracts.OpenDocument** 调起系统文件选择器，实现对语音备忘录、下载目录等音频来源的统一导入。

该功能的关键点包括：

使用 MIME 类型过滤（`audio/*`），避免无关文件被选中
使用 `Uri` 作为统一音频引用方式，减少对真实路径的依赖
将导入文件与录音生成的文件统一抽象为“音轨输入”，简化后续处理逻辑

这一设计保证了“录音”和“导入文件”两种来源在功能层面的等价性。

四、音轨管理与状态回传复杂度

在 AddTrack 与 RecordTrack 页面之间，我需要实现 **跨页面状态回传**，将录音结果或导入的音频正确带回音轨创建流程。

该部分的难点主要体现在：

Compose 状态（State / remember）与 Navigation BackStack 的协同
页面返回时防止旧状态重复触发
已选音频在 UI 中的即时展示与清理逻辑

为此，我在 AppNav 中维护统一的 `recordedUriString` 状态，并在 AddTrack 页面通过 `LaunchedEffect` 接收并消费该状态，避免脏数据残留。

五、UI 状态驱动与交互一致性问题

RapMix 的多个关键页面（录音、音轨选择、创建流程）都存在明显的 **状态切换行为**，例如：

录音前 / 录音中 / 录音完成
未选择音频 / 已选择音频
可添加音轨 / 禁用操作

这些状态全部通过 Compose 的响应式机制驱动 UI 渲染，避免了命令式 UI 中常见的状态不同步问题，但同时也对状态设计的完整性提出了较高要求。

六、权限、存储与跨版本适配问题

在项目中我重点处理了以下平台级问题：

录音权限的声明与运行时申请
使用应用私有目录（cacheDir）避免复杂的外部存储权限
使用 `Uri` 而非真实路径，减少 Android 版本差异带来的风险

这些设计在降低实现复杂度的同时，也为后续音频处理与分享功能保留了扩展空间。

七、为后续“音频净化”功能预留的结构设计

虽然当前阶段尚未真正实现音频净化算法，但在整体架构中我已经完成了关键前置工作：

所有音频输入统一抽象为音轨资源
录音与导入文件共享同一处理入口
页面流程明确区分“采集阶段”与“处理阶段”

这为后续接入 **本地音频处理算法或云端音频净化服务** 提供了清晰、可扩展的基础结构。

八、个人研发工作量说明

截至目前，RapMix 项目中我已完成并维护的核心内容包括：

多个 Compose 页面（Create / AddTrack / RecordTrack 等）
Navigation Compose 路由体系与页面回传逻辑
MediaRecorder 录音模块与权限处理
音频文件导入流程
UI 状态驱动与交互细节打磨
Manifest、主题、权限与兼容性配置

整体工作覆盖了UI、系统能力调用、状态管理与应用架构设计等多个层面。

